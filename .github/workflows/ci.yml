name: CI

on: workflow_dispatch

env:
  GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
  ENABLE_WORKFLOW_URL: https://api.github.com/repos/zhangc110033/xiaoMing/actions/workflows/delay.yml/enable
  GITHUB_WORKFLOW_URL: ${{github.server_url}}/${{github.repository}}/actions/runs/${{github.run_id}}

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 18

      # - name: Enable workflow
      #   run: |
      #     curl -X PUT \
      #     -H "Accept: application/vnd.github+json" \
      #     -H "Authorization: Bearer $GITHUB_TOKEN" \
      #     -H "X-GitHub-Api-Version: 2022-11-28" \
      #     $ENABLE_WORKFLOW_URL
      
      - name: Notify
        run: |
          curl -X POST -H "Content-Type: application/json" \
           -d '{
            "msg_type": "post",
            "content": {
              "post": {
                "zh-CN": {
                  "title": "The production preview E2E-Test has failed!",
                  "content": [
                    [
                      {
                        "tag": "a",
                        "text": "Click here to check",
                        "href": "${{env.GITHUB_WORKFLOW_URL}}"
                      }
                    ]
                  ]
                }
              }
            }
          }' \
          https://open.feishu.cn/open-apis/bot/v2/hook/8017099d-418e-4cf0-8636-0bdae81be4e3
